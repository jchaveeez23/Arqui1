import time
import board
import adafruit_dht
import RPi.GPIO as GPIO

# Configuración GPIO
FAN_PIN = 17   # Pin GPIO17 (físico 11)
GPIO.setmode(GPIO.BCM)
GPIO.setup(FAN_PIN, GPIO.OUT)
GPIO.output(FAN_PIN, GPIO.LOW)

# Configuración DHT11
dht_device = adafruit_dht.DHT11(board.D1)

# Umbral de temperatura
TEMP_UMBRAL = 28  # °C

try:
    while True:
        try:
            temperature_c = dht_device.temperature
            humidity = dht_device.humidity

            if temperature_c is not None and humidity is not None:
                print(f"Temperatura: {temperature_c:.1f} °C")
                print(f"Humedad: {humidity:.1f} %")

                # Control del ventilador
                if temperature_c >= TEMP_UMBRAL:
                    GPIO.output(FAN_PIN, GPIO.HIGH)  # Enciende ventilador
                    print("Ventilador ENCENDIDO")
                else:
                    GPIO.output(FAN_PIN, GPIO.LOW)   # Apaga ventilador
                    print("Ventilador APAGADO")
            else:
                print("Error: No se pudo leer el sensor. Reintentando...")

        except RuntimeError as error:
            print("Error de lectura:", error.args[0])

        time.sleep(5)

except KeyboardInterrupt:
    print("Programa detenido por el usuario.")
finally:
    GPIO.cleanup()
